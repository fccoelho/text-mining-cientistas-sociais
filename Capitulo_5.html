

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Construindo um Classificador de Textos &#8212; Mineração de textos para Cientistas Sociais</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Capitulo_5';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Analizando Redes de Colaboração Científica" href="Capitulo_6.html" />
    <link rel="prev" title="Aplicando modelagem de assuntos ao DHBB" href="Capitulo_4.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">Mineração de textos para Cientistas Sociais</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Mineração de Textos para Cientistas Sociais
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Capitulo_1.html">Abrindo Arquivos de Texto</a></li>


<li class="toctree-l1"><a class="reference internal" href="Capitulo_2.html">Contando Palavras</a></li>



<li class="toctree-l1"><a class="reference internal" href="Capitulo_3.html">Identificando Entidades Nomeadas e Similaridade Semântica</a></li>

<li class="toctree-l1"><a class="reference internal" href="Capitulo_4.html">Aplicando modelagem de assuntos ao DHBB</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Construindo um Classificador de Textos</a></li>
<li class="toctree-l1"><a class="reference internal" href="Capitulo_6.html">Analizando Redes de Colaboração Científica</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/fccoelho/text-mining-cientistas-sociais/blob/master/Capitulo_5.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fccoelho/text-mining-cientistas-sociais" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fccoelho/text-mining-cientistas-sociais/issues/new?title=Issue%20on%20page%20%2FCapitulo_5.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Capitulo_5.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Construindo um Classificador de Textos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparando-o-corpus">Preparando o corpus</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carregando-o-modelo-word2vec">Carregando o Modelo Word2vec</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparando-os-dados-treinamento-do-classificador">Preparando os dados treinamento do Classificador</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definindo-a-categoria-de-cada-documento-para-o-treinamento">Definindo a categoria de cada documento para o treinamento</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definindo-os-modelos">Definindo os modelos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#treinando-e-validando-o-classificador">Treinando e validando o classificador</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#curva-roc-para-os-classificadores">Curva ROC para os classificadores</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acuracia">Acurácia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#precisao-e-revocacao">Precisão e Revocação</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="construindo-um-classificador-de-textos">
<h1>Construindo um Classificador de Textos<a class="headerlink" href="#construindo-um-classificador-de-textos" title="Permalink to this heading">#</a></h1>
<p>Uma das aplicações mais comuns em mineração de textos é a classificações de documentos em categorias pré-definidas, sejam elas autorais, temáticas, temporais ou outras.</p>
<p>Neste capítulo iremos explorar os passos necessários para o desenvolvimento de um classificador de documentos utilizando as análises feitas sobre o corpus do DHBB nos capítulos anteriores.</p>
<p>Para esta tarefa utilizaremos modelos de machine learning clássicos disponibilizados na biblioteca <a class="reference external" href="https://scikit-learn.org/">Scikit-Learn</a>. Começaremos então importando algumas funcionalidades a partir do Scikit-Learn. Os demais imports já foram utilizados anteriormente.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">VotingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">ExtraTreesClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_val_predict</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">Word2Vec</span><span class="p">,</span> <span class="n">word2vec</span>
<span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">punctuation</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<section id="preparando-o-corpus">
<h2>Preparando o corpus<a class="headerlink" href="#preparando-o-corpus" title="Permalink to this heading">#</a></h2>
<p>Vamos utilizar o corpus do DHBB conforme armazenado na biblioteca SQLite anteriormente. Abaixo iremos desenvolver um iterador sobre o corpus que fará um preprocessamento básico dos documentos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///minha_tabela.sqlite&quot;</span><span class="p">)</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;pt_core_news_sm&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DHBBCorpus</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndocs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndocs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">7838</span><span class="p">,</span><span class="n">ndocs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">eng</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;select corpo from resultados limit </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndocs</span><span class="si">}</span><span class="s1">;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_process</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">d</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="o">%</span><span class="k">10</span> == 0:
                    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verbete </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="s2"> de </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndocs</span><span class="si">}</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                
                <span class="k">yield</span> <span class="n">d</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="nf">pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tagger&#39;</span><span class="p">,</span> <span class="s1">&#39;ner&#39;</span><span class="p">,</span><span class="s1">&#39;entity-linker&#39;</span><span class="p">,</span> <span class="s1">&#39;textcat&#39;</span><span class="p">,</span><span class="s1">&#39;entity-ruler&#39;</span><span class="p">,</span><span class="s1">&#39;merge-noun-chunks&#39;</span><span class="p">,</span><span class="s1">&#39;merge-entities&#39;</span><span class="p">,</span><span class="s1">&#39;merge-subtokens&#39;</span><span class="p">])</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">n</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_stop</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///minha_tabela.sqlite&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;pt_core_news_sm&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">class</span> <span class="nc">DHBBCorpus</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndocs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

<span class="nn">File ~/MEGAsync/Cursos/text-mining-cientistas-sociais/.venv/lib/python3.11/site-packages/spacy/__init__.py:51,</span> in <span class="ni">load</span><span class="nt">(name, vocab, disable, enable, exclude, config)</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="o">*</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>     <span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Config</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">SimpleFrozenDict</span><span class="p">(),</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Language</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Load a spaCy model from an installed package or a local path.</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">38</span><span class="sd">     name (str): Package name or model path.</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span><span class="sd">     RETURNS (Language): The loaded nlp object.</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">51</span>     <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="n">name</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>         <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span>         <span class="n">disable</span><span class="o">=</span><span class="n">disable</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>         <span class="n">enable</span><span class="o">=</span><span class="n">enable</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>         <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>         <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>     <span class="p">)</span>

<span class="nn">File ~/MEGAsync/Cursos/text-mining-cientistas-sociais/.venv/lib/python3.11/site-packages/spacy/util.py:472,</span> in <span class="ni">load_model</span><span class="nt">(name, vocab, disable, enable, exclude, config)</span>
<span class="g g-Whitespace">    </span><span class="mi">470</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">OLD_MODEL_SHORTCUTS</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">471</span>     <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">Errors</span><span class="o">.</span><span class="n">E941</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="n">OLD_MODEL_SHORTCUTS</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>  <span class="c1"># type: ignore[index]</span>
<span class="ne">--&gt; </span><span class="mi">472</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">Errors</span><span class="o">.</span><span class="n">E050</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">))</span>

<span class="ne">OSError</span>: [E050] Can&#39;t find model &#39;pt_core_news_sm&#39;. It doesn&#39;t seem to be a Python package or a valid path to a data directory.
</pre></div>
</div>
</div>
</div>
</section>
<section id="carregando-o-modelo-word2vec">
<h2>Carregando o Modelo Word2vec<a class="headerlink" href="#carregando-o-modelo-word2vec" title="Permalink to this heading">#</a></h2>
<p>Vamos utilizar a representação vetorial do corpus construida anteriormente como base para o treinamento do classificador.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;dhbb.w2v&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">vectors</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(38762, 100)
</pre></div>
</div>
</div>
</div>
<p>Como  o word2vec é uma representação vetorial do vocabulário do corpus, e desejamos treinar um modelo para classificar documentos, precisamos primeiro construir uma representação dos documentos do corpus no mesmo espaço vetorial gerado pelo Word2vec.</p>
<p>Na função abaixo, contruimos um vetor de documento que é a média dos vetores das palavras únicas que este contém.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_document_vector</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a scaled vector for the document (mean of the words present in it)</span>
<span class="sd">    :param text: document to be vectorized (tokenized)</span>
<span class="sd">    :param model: word2vec model</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_count</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">feature_count</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature_count</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mf">0.</span>
    

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vec</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature_count</span><span class="p">))</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mf">1.</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vec</span> <span class="o">/=</span> <span class="n">count</span>
    <span class="k">return</span> <span class="n">vec</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gera_docv</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">corpus</span> <span class="o">=</span> <span class="n">DHBBCorpus</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">build_document_vector</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>
        <span class="k">yield</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="preparando-os-dados-treinamento-do-classificador">
<h2>Preparando os dados treinamento do Classificador<a class="headerlink" href="#preparando-os-dados-treinamento-do-classificador" title="Permalink to this heading">#</a></h2>
<p>Abaixo vamos calcular os vetores dos documentos no espaço definido pelo W2V. Como este é um processo longo vamos salvar o resultado, para não ter que re-gerar os vetores de documento das próximas vezes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;doc_feature_matrix.csv.gz&#39;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;doc_feature_matrix.csv.gz&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">gerador</span> <span class="o">=</span> <span class="n">gera_docv</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">gerador</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;doc_feature_matrix.csv.gz&#39;</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verbete 7830 de 7838
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>90</th>
      <th>91</th>
      <th>92</th>
      <th>93</th>
      <th>94</th>
      <th>95</th>
      <th>96</th>
      <th>97</th>
      <th>98</th>
      <th>99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.251411</td>
      <td>-0.092618</td>
      <td>-0.367610</td>
      <td>0.156986</td>
      <td>-0.339056</td>
      <td>-0.080486</td>
      <td>0.192228</td>
      <td>-0.230927</td>
      <td>-0.129720</td>
      <td>0.112671</td>
      <td>...</td>
      <td>-0.354930</td>
      <td>0.257672</td>
      <td>-0.182260</td>
      <td>-0.072084</td>
      <td>0.155995</td>
      <td>0.025738</td>
      <td>-0.186744</td>
      <td>-0.309680</td>
      <td>0.003222</td>
      <td>0.116559</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.444796</td>
      <td>-0.107734</td>
      <td>-0.371062</td>
      <td>0.248178</td>
      <td>-0.342896</td>
      <td>0.180991</td>
      <td>0.622804</td>
      <td>0.390060</td>
      <td>-0.197826</td>
      <td>0.005668</td>
      <td>...</td>
      <td>0.162281</td>
      <td>-0.923582</td>
      <td>-0.449693</td>
      <td>-0.194215</td>
      <td>0.884861</td>
      <td>0.355686</td>
      <td>0.418442</td>
      <td>-0.504399</td>
      <td>-1.110405</td>
      <td>0.292351</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.186797</td>
      <td>-0.099321</td>
      <td>-0.489939</td>
      <td>0.603691</td>
      <td>-0.220742</td>
      <td>0.163514</td>
      <td>0.201998</td>
      <td>-0.068645</td>
      <td>-0.170712</td>
      <td>0.071279</td>
      <td>...</td>
      <td>0.309139</td>
      <td>-0.249686</td>
      <td>-0.252961</td>
      <td>-0.000214</td>
      <td>0.428697</td>
      <td>0.477869</td>
      <td>0.114001</td>
      <td>-0.259199</td>
      <td>-0.860501</td>
      <td>0.281628</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.015474</td>
      <td>-0.331179</td>
      <td>-0.188871</td>
      <td>0.071852</td>
      <td>-0.118083</td>
      <td>0.273842</td>
      <td>0.244981</td>
      <td>-0.070634</td>
      <td>-0.275265</td>
      <td>0.211026</td>
      <td>...</td>
      <td>0.048260</td>
      <td>0.186905</td>
      <td>-0.201033</td>
      <td>-0.294315</td>
      <td>-0.119009</td>
      <td>0.070466</td>
      <td>-0.013867</td>
      <td>-0.257075</td>
      <td>-0.069757</td>
      <td>0.215312</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.069459</td>
      <td>0.000653</td>
      <td>-0.267939</td>
      <td>0.539355</td>
      <td>-0.167328</td>
      <td>-0.028850</td>
      <td>0.572703</td>
      <td>0.225255</td>
      <td>-0.364476</td>
      <td>0.159628</td>
      <td>...</td>
      <td>0.073481</td>
      <td>-0.567660</td>
      <td>-0.298699</td>
      <td>-0.237357</td>
      <td>0.528733</td>
      <td>0.298273</td>
      <td>0.037333</td>
      <td>-0.491313</td>
      <td>-0.742250</td>
      <td>0.370616</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7833</th>
      <td>-0.069599</td>
      <td>0.153431</td>
      <td>-0.571671</td>
      <td>0.378038</td>
      <td>-0.248409</td>
      <td>-0.060014</td>
      <td>0.452256</td>
      <td>0.176986</td>
      <td>-0.235890</td>
      <td>0.001420</td>
      <td>...</td>
      <td>-0.191336</td>
      <td>-0.586688</td>
      <td>-0.180140</td>
      <td>-0.130464</td>
      <td>0.625573</td>
      <td>0.382755</td>
      <td>0.069184</td>
      <td>-0.546153</td>
      <td>-0.663578</td>
      <td>0.326829</td>
    </tr>
    <tr>
      <th>7834</th>
      <td>-0.170249</td>
      <td>-0.081334</td>
      <td>-0.492545</td>
      <td>0.443016</td>
      <td>-0.041892</td>
      <td>0.183765</td>
      <td>0.371429</td>
      <td>0.106385</td>
      <td>-0.080806</td>
      <td>0.181276</td>
      <td>...</td>
      <td>0.225322</td>
      <td>-0.254757</td>
      <td>-0.258577</td>
      <td>0.014742</td>
      <td>0.309729</td>
      <td>0.376458</td>
      <td>0.032279</td>
      <td>-0.256777</td>
      <td>-0.743823</td>
      <td>0.226570</td>
    </tr>
    <tr>
      <th>7835</th>
      <td>-0.382044</td>
      <td>-0.422822</td>
      <td>-0.587220</td>
      <td>0.320492</td>
      <td>-0.226514</td>
      <td>0.172044</td>
      <td>0.616719</td>
      <td>-0.043985</td>
      <td>-0.258257</td>
      <td>0.217810</td>
      <td>...</td>
      <td>-0.005524</td>
      <td>-0.341694</td>
      <td>-0.393351</td>
      <td>-0.104909</td>
      <td>0.011569</td>
      <td>0.355231</td>
      <td>0.376438</td>
      <td>-0.383147</td>
      <td>-0.443361</td>
      <td>0.176735</td>
    </tr>
    <tr>
      <th>7836</th>
      <td>0.226604</td>
      <td>-0.230992</td>
      <td>-0.294525</td>
      <td>-0.005927</td>
      <td>-0.293173</td>
      <td>0.076686</td>
      <td>0.057251</td>
      <td>-0.154211</td>
      <td>-0.186203</td>
      <td>0.165438</td>
      <td>...</td>
      <td>-0.148946</td>
      <td>0.358122</td>
      <td>-0.054703</td>
      <td>-0.052285</td>
      <td>0.038732</td>
      <td>0.011719</td>
      <td>-0.135485</td>
      <td>-0.256960</td>
      <td>0.012294</td>
      <td>0.020287</td>
    </tr>
    <tr>
      <th>7837</th>
      <td>-0.403669</td>
      <td>-0.057501</td>
      <td>-0.323550</td>
      <td>0.505035</td>
      <td>0.161119</td>
      <td>0.269930</td>
      <td>0.552717</td>
      <td>0.165518</td>
      <td>-0.195108</td>
      <td>0.275592</td>
      <td>...</td>
      <td>0.346420</td>
      <td>-0.500232</td>
      <td>-0.054664</td>
      <td>0.061566</td>
      <td>0.117811</td>
      <td>0.438892</td>
      <td>0.224275</td>
      <td>-0.340123</td>
      <td>-0.692458</td>
      <td>0.498602</td>
    </tr>
  </tbody>
</table>
<p>7838 rows × 100 columns</p>
</div></div></div>
</div>
<section id="definindo-a-categoria-de-cada-documento-para-o-treinamento">
<h3>Definindo a categoria de cada documento para o treinamento<a class="headerlink" href="#definindo-a-categoria-de-cada-documento-para-o-treinamento" title="Permalink to this heading">#</a></h3>
<p>Nosso objetvo será diferenciar entre verbetes <em>temáticos</em> e <em>biográficos</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gera_alvo</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;select natureza from resultados&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">eng</span><span class="p">)</span>
    <span class="n">alvo</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">natureza</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="s1">&#39;biográfico&#39;</span>
    <span class="k">return</span> <span class="n">alvo</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">gera_alvo</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Número de verbetes temáticos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Número de verbetes temáticos: 973
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s1">&#39;select * from resultados&#39;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">eng</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">natureza</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>biográfico    6865
temático       973
Name: natureza, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Vamos dividir a tabela de vetores de documentos em Biográficos e temáticos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">biog</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span>
<span class="n">tem</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">~</span><span class="n">Y</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Como o número de verbetes biográficos é muito maior, vamos tomar iguais numeros de cada tipo para equilibrar o nosso conjunto de treinamento de documentos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">biog</span><span class="p">[:</span><span class="mi">963</span><span class="p">],</span><span class="n">tem</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="mi">963</span> <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="mi">963</span><span class="p">)</span>
<span class="c1"># data2[&#39;Y2&#39;] = Y2</span>
<span class="c1"># data2 = data2.sample(frac=1).reset_index(drop=True) #shuffle the</span>
<span class="c1"># Y2 = data2.pop(&#39;Y2&#39;)</span>
<span class="c1"># print(len(Y2))</span>
<span class="n">data2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>90</th>
      <th>91</th>
      <th>92</th>
      <th>93</th>
      <th>94</th>
      <th>95</th>
      <th>96</th>
      <th>97</th>
      <th>98</th>
      <th>99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.251411</td>
      <td>-0.092618</td>
      <td>-0.367610</td>
      <td>0.156986</td>
      <td>-0.339056</td>
      <td>-0.080486</td>
      <td>0.192228</td>
      <td>-0.230927</td>
      <td>-0.129720</td>
      <td>0.112671</td>
      <td>...</td>
      <td>-0.354930</td>
      <td>0.257672</td>
      <td>-0.182260</td>
      <td>-0.072084</td>
      <td>0.155995</td>
      <td>0.025738</td>
      <td>-0.186744</td>
      <td>-0.309680</td>
      <td>0.003222</td>
      <td>0.116559</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.444796</td>
      <td>-0.107734</td>
      <td>-0.371062</td>
      <td>0.248178</td>
      <td>-0.342896</td>
      <td>0.180991</td>
      <td>0.622804</td>
      <td>0.390060</td>
      <td>-0.197826</td>
      <td>0.005668</td>
      <td>...</td>
      <td>0.162281</td>
      <td>-0.923582</td>
      <td>-0.449693</td>
      <td>-0.194215</td>
      <td>0.884861</td>
      <td>0.355686</td>
      <td>0.418442</td>
      <td>-0.504399</td>
      <td>-1.110405</td>
      <td>0.292351</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.186797</td>
      <td>-0.099321</td>
      <td>-0.489939</td>
      <td>0.603691</td>
      <td>-0.220742</td>
      <td>0.163514</td>
      <td>0.201998</td>
      <td>-0.068645</td>
      <td>-0.170712</td>
      <td>0.071279</td>
      <td>...</td>
      <td>0.309139</td>
      <td>-0.249686</td>
      <td>-0.252961</td>
      <td>-0.000214</td>
      <td>0.428697</td>
      <td>0.477869</td>
      <td>0.114001</td>
      <td>-0.259199</td>
      <td>-0.860501</td>
      <td>0.281628</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.015474</td>
      <td>-0.331179</td>
      <td>-0.188871</td>
      <td>0.071852</td>
      <td>-0.118083</td>
      <td>0.273842</td>
      <td>0.244981</td>
      <td>-0.070634</td>
      <td>-0.275265</td>
      <td>0.211026</td>
      <td>...</td>
      <td>0.048260</td>
      <td>0.186905</td>
      <td>-0.201033</td>
      <td>-0.294315</td>
      <td>-0.119009</td>
      <td>0.070466</td>
      <td>-0.013867</td>
      <td>-0.257075</td>
      <td>-0.069757</td>
      <td>0.215312</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.069459</td>
      <td>0.000653</td>
      <td>-0.267939</td>
      <td>0.539355</td>
      <td>-0.167328</td>
      <td>-0.028850</td>
      <td>0.572703</td>
      <td>0.225255</td>
      <td>-0.364476</td>
      <td>0.159628</td>
      <td>...</td>
      <td>0.073481</td>
      <td>-0.567660</td>
      <td>-0.298699</td>
      <td>-0.237357</td>
      <td>0.528733</td>
      <td>0.298273</td>
      <td>0.037333</td>
      <td>-0.491313</td>
      <td>-0.742250</td>
      <td>0.370616</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7799</th>
      <td>-0.009590</td>
      <td>-0.370285</td>
      <td>-0.351947</td>
      <td>0.375928</td>
      <td>-0.312881</td>
      <td>0.284171</td>
      <td>0.218668</td>
      <td>-0.185607</td>
      <td>-0.080803</td>
      <td>0.464115</td>
      <td>...</td>
      <td>-0.177752</td>
      <td>0.476271</td>
      <td>0.062159</td>
      <td>0.180202</td>
      <td>-0.104882</td>
      <td>-0.123912</td>
      <td>-0.011329</td>
      <td>-0.059178</td>
      <td>0.072528</td>
      <td>-0.095532</td>
    </tr>
    <tr>
      <th>7815</th>
      <td>0.190164</td>
      <td>-0.421917</td>
      <td>0.041171</td>
      <td>0.559976</td>
      <td>-0.096135</td>
      <td>0.262056</td>
      <td>0.115327</td>
      <td>-0.222292</td>
      <td>0.159212</td>
      <td>0.254804</td>
      <td>...</td>
      <td>0.079692</td>
      <td>0.391770</td>
      <td>-0.041344</td>
      <td>0.181603</td>
      <td>-0.474300</td>
      <td>-0.066437</td>
      <td>-0.211216</td>
      <td>-0.201937</td>
      <td>0.157055</td>
      <td>0.150917</td>
    </tr>
    <tr>
      <th>7818</th>
      <td>0.113591</td>
      <td>-0.304503</td>
      <td>0.023514</td>
      <td>0.285975</td>
      <td>-0.131286</td>
      <td>0.313704</td>
      <td>-0.003414</td>
      <td>-0.047683</td>
      <td>0.036644</td>
      <td>0.179127</td>
      <td>...</td>
      <td>0.135317</td>
      <td>0.436429</td>
      <td>-0.045782</td>
      <td>0.063444</td>
      <td>-0.378774</td>
      <td>-0.120447</td>
      <td>-0.178072</td>
      <td>-0.160545</td>
      <td>0.119899</td>
      <td>-0.047110</td>
    </tr>
    <tr>
      <th>7820</th>
      <td>-0.209527</td>
      <td>-0.324761</td>
      <td>-0.133246</td>
      <td>0.322462</td>
      <td>-0.087852</td>
      <td>0.493621</td>
      <td>0.207157</td>
      <td>0.010970</td>
      <td>0.073835</td>
      <td>0.143174</td>
      <td>...</td>
      <td>0.062675</td>
      <td>0.328040</td>
      <td>-0.080370</td>
      <td>0.155594</td>
      <td>-0.452543</td>
      <td>0.000524</td>
      <td>-0.078063</td>
      <td>-0.163876</td>
      <td>0.080908</td>
      <td>0.207743</td>
    </tr>
    <tr>
      <th>7832</th>
      <td>0.219356</td>
      <td>-0.023952</td>
      <td>-0.126478</td>
      <td>-0.041252</td>
      <td>-0.207852</td>
      <td>-0.374994</td>
      <td>0.230476</td>
      <td>-0.430638</td>
      <td>-0.519447</td>
      <td>-0.460002</td>
      <td>...</td>
      <td>-0.234624</td>
      <td>0.342272</td>
      <td>-0.037796</td>
      <td>0.341001</td>
      <td>0.306884</td>
      <td>0.136352</td>
      <td>0.090791</td>
      <td>-0.088957</td>
      <td>0.088237</td>
      <td>0.242391</td>
    </tr>
  </tbody>
</table>
<p>1936 rows × 100 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="k">def</span> <span class="nf">print_class_report</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">clf</span><span class="p">,</span> <span class="n">clf_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Imprime relatório de classificação</span>
<span class="sd">    :param Xtest:</span>
<span class="sd">    :param Ytest:</span>
<span class="sd">    :param clf: classificador trainado</span>
<span class="sd">    :param clf_name: nome do classificador</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y_predict</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Relatório de classificação para </span><span class="si">{}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clf_name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">Ytest</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Temático&#39;</span><span class="p">,</span> <span class="s1">&#39;Biográfico&#39;</span><span class="p">]))</span>
    

<span class="k">def</span> <span class="nf">plot_roc</span><span class="p">(</span><span class="n">probas</span><span class="p">):</span>
    <span class="n">tprs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fprs</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;False positive rate&#39;</span><span class="p">,</span> <span class="s1">&#39;True Positive rate&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">probas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">roc_aucs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">roc_aucs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">))</span>
            <span class="n">tprs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tpr</span><span class="p">])</span>
            <span class="n">fprs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fpr</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: AUCs: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">roc_aucs</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fprs</span><span class="p">,</span> <span class="n">tprs</span><span class="p">,</span> <span class="p">[],</span> <span class="s2">&quot;Curva ROC &quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="definindo-os-modelos">
<h2>Definindo os modelos<a class="headerlink" href="#definindo-os-modelos" title="Permalink to this heading">#</a></h2>
<p>Vamos comparar a performance de 3 modelos. Dois tipos de modelos de “ensemble”, <em>Random forest</em> e <em>Extra Trees</em> e um terceiro baseado na segmentação do espaço vetorial, o SVC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfclf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">etclf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span><span class="n">ExtraTreesClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">svcclf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span><span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Adicionalmente iremos usar um Classificador por votos que procurará combinar o melhor dos três modelos acima em uma classificação por votação.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vcclf</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="n">rfclf</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;et&#39;</span><span class="p">,</span> <span class="n">etclf</span><span class="p">),(</span><span class="s1">&#39;svc&#39;</span><span class="p">,</span> <span class="n">svcclf</span><span class="p">)],</span> 
                         <span class="n">voting</span><span class="o">=</span><span class="s1">&#39;soft&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="treinando-e-validando-o-classificador">
<h2>Treinando e validando o classificador<a class="headerlink" href="#treinando-e-validando-o-classificador" title="Permalink to this heading">#</a></h2>
<p>Os modelos serão treinados usando um esquema de validação cruzada de três rodadas com randomização.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">RocCurveDisplay</span>

<span class="n">acc_hist</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">values</span>

<span class="n">Xtrain</span><span class="p">,</span><span class="n">Xtest</span><span class="p">,</span><span class="n">Ytrain</span><span class="p">,</span><span class="n">Ytest</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="n">Y2</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">.25</span><span class="p">)</span>

<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">skf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">):</span>
    <span class="n">Xtr</span> <span class="o">=</span> <span class="n">Xtrain</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
    <span class="n">Ytr</span> <span class="o">=</span> <span class="n">Ytrain</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
    <span class="n">Xval</span> <span class="o">=</span> <span class="n">Xtrain</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
    <span class="n">Yval</span> <span class="o">=</span> <span class="n">Ytrain</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==&gt; Fitting:&quot;</span><span class="p">)</span>
    <span class="c1"># print(&quot;Extra Trees&quot;)</span>
    <span class="n">etclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtr</span><span class="p">,</span><span class="n">Ytrain</span><span class="p">[</span><span class="n">train_index</span><span class="p">])</span>
    <span class="c1"># print(&quot;Random Forest&quot;)</span>
    <span class="n">rfclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtr</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">[</span><span class="n">train_index</span><span class="p">])</span>
    <span class="c1"># print(&quot;SVC&quot;)</span>
    <span class="n">svcclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtr</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">[</span><span class="n">train_index</span><span class="p">])</span>
    <span class="c1"># print(&quot;Voting&quot;)</span>
    <span class="n">vcclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtr</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">[</span><span class="n">train_index</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==&gt; Scoring:&quot;</span><span class="p">)</span>
    <span class="n">acc_hist</span><span class="p">[</span><span class="s1">&#39;ET&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">etclf</span><span class="p">,</span> <span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">acc_hist</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">rfclf</span><span class="p">,</span> <span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">acc_hist</span><span class="p">[</span><span class="s1">&#39;SVC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">svcclf</span><span class="p">,</span> <span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">acc_hist</span><span class="p">[</span><span class="s1">&#39;Voting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vcclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">))</span>
<span class="n">print_class_report</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">etclf</span><span class="p">,</span> <span class="s1">&#39;ET&#39;</span><span class="p">)</span>
<span class="n">print_class_report</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">rfclf</span><span class="p">,</span> <span class="s1">&#39;RF&#39;</span><span class="p">)</span>
<span class="n">print_class_report</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">svcclf</span><span class="p">,</span> <span class="s1">&#39;SVC&#39;</span><span class="p">)</span>
<span class="n">print_class_report</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">vcclf</span><span class="p">,</span> <span class="s1">&#39;Voting&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==&gt; Fitting:
==&gt; Scoring:
==&gt; Fitting:
==&gt; Scoring:
==&gt; Fitting:
==&gt; Scoring:
==&gt; Fitting:
==&gt; Scoring:
==&gt; Fitting:
==&gt; Scoring:

Relatório de classificação para ET:

              precision    recall  f1-score   support

    Temático       0.92      0.91      0.91       248
  Biográfico       0.90      0.92      0.91       234

    accuracy                           0.91       482
   macro avg       0.91      0.91      0.91       482
weighted avg       0.91      0.91      0.91       482


Relatório de classificação para RF:

              precision    recall  f1-score   support

    Temático       0.98      0.92      0.95       248
  Biográfico       0.92      0.98      0.95       234

    accuracy                           0.95       482
   macro avg       0.95      0.95      0.95       482
weighted avg       0.95      0.95      0.95       482


Relatório de classificação para SVC:

              precision    recall  f1-score   support

    Temático       0.90      0.80      0.85       248
  Biográfico       0.81      0.90      0.85       234

    accuracy                           0.85       482
   macro avg       0.85      0.85      0.85       482
weighted avg       0.86      0.85      0.85       482


Relatório de classificação para Voting:

              precision    recall  f1-score   support

    Temático       0.89      0.84      0.87       248
  Biográfico       0.84      0.89      0.87       234

    accuracy                           0.87       482
   macro avg       0.87      0.87      0.87       482
weighted avg       0.87      0.87      0.87       482
</pre></div>
</div>
</div>
</div>
<section id="curva-roc-para-os-classificadores">
<h3>Curva ROC para os classificadores<a class="headerlink" href="#curva-roc-para-os-classificadores" title="Permalink to this heading">#</a></h3>
<p>A curva ROC nos informa o quanto podemos maximizar a taxa de verdadeiros positivos(classificações corretas), ao mesmo tempo em que minimizamos a taxa de falsos positivos (classificações erradas), apenas escolhendo a probabilidade de corte para pertinência à classe 1. O melhor modelo é o que mais se aproxima do canto superior esquerdo da figura (maximizando a área sob a curva), neste caso o modelo <em>Random Forest</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  ROC curve for each model</span>

<span class="n">et_roc</span> <span class="o">=</span> <span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">etclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Extra Trees&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">rf_roc</span> <span class="o">=</span> <span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">rfclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span>
<span class="n">svc_roc</span> <span class="o">=</span> <span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">svcclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SVC&#39;</span><span class="p">)</span>
<span class="n">vc_roc</span> <span class="o">=</span> <span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">vcclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Voting&#39;</span><span class="p">)</span>

<span class="c1"># print(&#39;trained {} documents.&#39;.format((n+1)*batchsize))</span>
<span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">acc_hist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/534878b7fbda6cfa8cbc5f9e3e36ea8be2e796be164bd06c244c446c25c8ada2.png" src="_images/534878b7fbda6cfa8cbc5f9e3e36ea8be2e796be164bd06c244c446c25c8ada2.png" />
</div>
</div>
</section>
<section id="acuracia">
<h3>Acurácia<a class="headerlink" href="#acuracia" title="Permalink to this heading">#</a></h3>
<p>Se olharmos para a acurácia, vemos que esta não melhora com as 5 rodadas de validação cruzada, indicando que podemos reduzí-las ou mesmo eliminar completamente a validação cruzada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_acc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ET</th>
      <th>RF</th>
      <th>SVC</th>
      <th>Voting</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.844183</td>
      <td>0.893352</td>
      <td>0.84903</td>
      <td>0.932825</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.846953</td>
      <td>0.890582</td>
      <td>0.84903</td>
      <td>0.929363</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.843490</td>
      <td>0.899584</td>
      <td>0.84903</td>
      <td>0.937673</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.842798</td>
      <td>0.900277</td>
      <td>0.84903</td>
      <td>0.936288</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.849723</td>
      <td>0.897507</td>
      <td>0.84903</td>
      <td>0.939058</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="precisao-e-revocacao">
<h3>Precisão e Revocação<a class="headerlink" href="#precisao-e-revocacao" title="Permalink to this heading">#</a></h3>
<p>Outra métrica para comparação dos modelos são suas curvas de Precisão-revocação, que apresentam os trade-offs possíveis entre estas duas medidas como função do limiar de decisão para cada classe. Nesta análise o modelo cuja curva mais se aproxima do canto superior direito da figura é o melhor, neste caso novamente o modelo <em>Random Forest</em> se destaca.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">PrecisionRecallDisplay</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span> <span class="o">=</span> <span class="n">PrecisionRecallDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span>
    <span class="n">etclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Extra Trees&quot;</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">PrecisionRecallDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span>
    <span class="n">rfclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
<span class="p">)</span>
<span class="n">PrecisionRecallDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span>
    <span class="n">svcclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SVC&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
<span class="p">)</span>
<span class="n">PrecisionRecallDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span>
    <span class="n">vcclf</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">Ytest</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Voting&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">ax_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Curva de Precisão-Revocação para duas categorias&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e7e2cd603d566b76324dffd03c3896bb9a23a89f85c395fcdeb65e8516c4abbb.png" src="_images/e7e2cd603d566b76324dffd03c3896bb9a23a89f85c395fcdeb65e8516c4abbb.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Capitulo_4.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Aplicando modelagem de assuntos ao DHBB</p>
      </div>
    </a>
    <a class="right-next"
       href="Capitulo_6.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Analizando Redes de Colaboração Científica</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparando-o-corpus">Preparando o corpus</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carregando-o-modelo-word2vec">Carregando o Modelo Word2vec</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparando-os-dados-treinamento-do-classificador">Preparando os dados treinamento do Classificador</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definindo-a-categoria-de-cada-documento-para-o-treinamento">Definindo a categoria de cada documento para o treinamento</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definindo-os-modelos">Definindo os modelos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#treinando-e-validando-o-classificador">Treinando e validando o classificador</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#curva-roc-para-os-classificadores">Curva ROC para os classificadores</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acuracia">Acurácia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#precisao-e-revocacao">Precisão e Revocação</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Flávio Codeço Coelho
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>